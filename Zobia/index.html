<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday, Zobia üéÇ‚ù§Ô∏è</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg1: #0b1220; /* deep midnight */
      --bg2: #1a2333; /* indigo twilight */
      --accent: #ff6f91; /* rose */
      --accent-2: #ffd6a5; /* soft peach-gold */
      --glass: rgba(255, 255, 255, 0.12);
      --glass-strong: rgba(255, 255, 255, 0.22);
      --text: #fff;
    }
    * { box-sizing: border-box }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: radial-gradient(1200px 800px at 20% 10%, #2a1a56 0%, transparent 60%),
                  radial-gradient(900px 700px at 80% 20%, #401b5e 0%, transparent 60%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      overflow: hidden;
    }
    #bg3d { position: fixed; inset: 0; z-index: 0; }
    .overlay { position: fixed; inset: 0; z-index: 2; display: grid; place-items: center; padding: 24px; pointer-events: none; }
    .card {
      width: min(880px, 95vw);
      background: linear-gradient(180deg, var(--glass-strong), var(--glass));
      backdrop-filter: blur(10px) saturate(120%);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 24px;
      box-shadow: 0 30px 90px rgba(0,0,0,0.35);
      padding: clamp(18px, 4vw, 36px);
      pointer-events: auto;
    }
    .headline { font-size: clamp(28px, 4.5vw, 56px); line-height: 1.1; font-weight: 800; margin: 0 0 8px 0; letter-spacing: 0.5px; text-shadow: 0 1px 0 rgba(0,0,0,0.2); }
    .subhead { font-size: clamp(16px, 2.1vw, 22px); opacity: .9; margin: 0 0 16px 0; }
    .msg { font-size: clamp(16px, 2.2vw, 20px); line-height: 1.6; min-height: 3em; white-space: pre-line; }
    .controls { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 20px; }
    button {
      appearance: none; border: none; cursor: pointer; color: white; font-weight: 700;
      padding: 12px 18px; border-radius: 14px; background: linear-gradient(180deg, #ff7fc7, #ff4fae);
      box-shadow: 0 10px 25px rgba(255, 79, 174, .35);
      transition: transform .08s ease, box-shadow .2s ease, filter .2s ease;
    }
    button.secondary { background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.08)); box-shadow: inset 0 0 0 1px rgba(255,255,255,.24); }
    button.ghost { background: transparent; box-shadow: none; border: 1px solid rgba(255,255,255,.25); }
    button:hover { transform: translateY(-2px); filter: brightness(1.05); }
    button:active { transform: translateY(0); }
    .chip { display: inline-flex; align-items: center; gap:8px; padding: 8px 12px; border-radius: 999px; background: rgba(255,255,255,.12); border: 1px solid rgba(255,255,255,.18); font-size: 14px; margin-bottom: 10px; }
    #confetti { position: fixed; inset:0; z-index: 3; pointer-events: none; }
    .help { position: fixed; right: 12px; bottom: 10px; font-size: 12px; opacity: .7; z-index: 4 }
    .no-three #bg3d { display: none; }
    .no-three body { background: radial-gradient(circle at 30% 20%, #3d185c, transparent 50%), linear-gradient(160deg, #13092b, #25174b); }

    /* Gate for mobile autoplay */
    .gate { position: fixed; inset: 0; z-index: 5; display:grid; place-items:center; background: linear-gradient(160deg, var(--bg1), var(--bg2)); }
    .gate-card { text-align:center; padding: 28px 26px; border-radius: 24px; background: linear-gradient(180deg, var(--glass-strong), var(--glass)); backdrop-filter: blur(12px); border:1px solid rgba(255,255,255,.18); box-shadow: 0 30px 90px rgba(0,0,0,.35); width: min(720px, 92vw); }
    .gate h2 { margin:0 0 8px 0; font-size: clamp(28px,4.4vw,46px); }
    .fade-out { animation: fadeOut .6s ease forwards; }
    @keyframes fadeOut { to { opacity:0; visibility:hidden } }
  </style>
</head>
<body>
  <div class="gate" id="gate">
    <div class="gate-card">
      <h2>Happy Birthday, Zobia ‚ú®</h2>
      <p style="opacity:.9;margin:6px 0 16px">Tap below to start the surprise with music and animations.</p>
      <button id="startBtn" type="button">Start the Experience üíñ</button>
    </div>
  </div>

  <canvas id="bg3d" aria-hidden="true"></canvas>
  <canvas id="confetti" aria-hidden="true"></canvas>

  <audio id="bgm" preload="auto">
    <source src="song.mp3" type="audio/mpeg">
  </audio>

  <div class="overlay">
    <div class="card">
      <div class="chip">üéâ A little surprise just for you</div>
      <h1 class="headline" id="title">Hello üëã</h1>
      <p class="subhead" id="subtitle">I made something special‚Ä¶</p>
      <div class="msg" id="message"></div>
      <div class="controls">
        <button id="prev" class="secondary" type="button">‚Üê Back</button>
        <button id="next" type="button">Next ‚Üí</button>
        <button id="replay" class="ghost" type="button">Replay ‚ú®</button>
        <button id="sound" class="secondary" type="button">üîá Sound</button>
      </div>
    </div>
  </div>

  <div class="help">Tip: Replace images in <code>assets/photos</code> & edit messages inside the file.</div>

  <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>

  <script>
    // PERSONALIZE
    const PHOTO_URLS = [
      'assets/photos/photo1.jpg',
      'assets/photos/photo2.jpg',
      'assets/photos/photo3.jpg',
      'assets/photos/photo4.jpg'
    ];

    const STEPS = [
      {
        title: 'Hello, Zobia üíñ',
        subtitle: 'I made a tiny universe just for you‚Ä¶',
        message: 'Close your eyes for one second and make a wish. Ready? Let\'s go ‚Üí'
      },
      {
        title: 'Happy Birthday, Zobia üéÇ',
        subtitle: 'Today is all about YOU',
        message: 'On this special day, I want you to feel celebrated, adored, and endlessly loved.'
      },
      {
        title: 'A message from my heart ‚úâÔ∏è',
        subtitle: 'Forever yours, ‚Äî M Ali Shan',
        message: `From the moment you walked into my life, everything changed in the most beautiful way. I never expected it, but then I found you and now you are my happiness, my peace, and the reason behind my smile every single day.

Every time I hear your voice or get to talk to you, my world lights up. You turn the simplest moments into memories I‚Äôll treasure forever. Words will never be enough to express how much I love you, but my heart whispers it with every beat: I love you more than anything, more than I ever thought was possible.

You are the best person I have ever met, the most precious gift life has given me. No matter what, I will always wait for you, always stand by you, and love you endlessly with all that I am.

Happy Birthday, my love, my Zobia. May your day be as magical and beautiful as you are. You are my forever, and I am the luckiest man in the world to call you mine.

‚Äî Forever Yours,
M Ali Shan`
      },
      {
        title: 'I love you so much ‚ù§Ô∏è',
        subtitle: 'Always. Forever. Every day.',
        message: 'No matter where life takes us, my heart will always find its way to you.'
      }
    ];

    // ELEMENTS
    const titleEl = document.getElementById('title');
    const subtitleEl = document.getElementById('subtitle');
    const messageEl = document.getElementById('message');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const replayBtn = document.getElementById('replay');
    const soundBtn = document.getElementById('sound');
    const bgm = document.getElementById('bgm');
    const startBtn = document.getElementById('startBtn');
    const gate = document.getElementById('gate');

    let idx = 0;

    function typeText(el, text, speed = 18) {
      return new Promise(resolve => {
        el.textContent = '';
        let i = 0;
        const timer = setInterval(() => {
          el.textContent = text.slice(0, i++);
          if (i > text.length) { clearInterval(timer); resolve(true); }
        }, speed);
      });
    }

    async function renderStep(i) {
      const s = STEPS[i];
      await typeText(titleEl, s.title, 14);
      subtitleEl.textContent = s.subtitle;
      await typeText(messageEl, s.message, 10);
      if (i === STEPS.length - 1) fireConfetti();
    }

    function updateButtons() {
      prevBtn.disabled = idx === 0;
      nextBtn.textContent = idx === STEPS.length - 1 ? 'Finish üí´' : 'Next ‚Üí';
    }

    // AUDIO
    let soundOn = false;
    let started = false;
    async function ensureBgm(startAt = 39) {
      if (started) return;
      started = true;
      try {
        bgm.currentTime = startAt;
      } catch(e) {}
      try {
        await bgm.play();
        soundOn = true;
        soundBtn.textContent = 'üîä Sound';
      } catch (e) {
        // Autoplay blocked; user can press Sound to play
        soundOn = false;
        soundBtn.textContent = 'üîá Sound';
      }
    }

    // Start: always remove the gate, then try audio
    startBtn.addEventListener('click', async () => {
      if (gate) { gate.classList.add('fade-out'); setTimeout(() => gate.remove(), 650); }
      updateButtons();
      renderStep(idx);
      ensureBgm(39);
    });

    prevBtn.addEventListener('click', () => { idx = Math.max(0, idx - 1); updateButtons(); renderStep(idx); });
    nextBtn.addEventListener('click', () => {
      if (idx < STEPS.length - 1) { idx++; updateButtons(); renderStep(idx); }
      else { idx = 0; updateButtons(); renderStep(idx); }
    });
    replayBtn.addEventListener('click', () => { renderStep(idx); });

    soundBtn.addEventListener('click', async () => {
      try {
        if (!soundOn) {
          await ensureBgm(39);
        } else {
          bgm.pause();
          soundOn = false;
          soundBtn.textContent = 'üîá Sound';
        }
      } catch(e) {}
    });

    // CONFETTI
    const confetti = document.getElementById('confetti');
    const ctx2d = confetti.getContext('2d');
    let pieces = [];
    function fireConfetti() {
      const w = confetti.width = window.innerWidth;
      const h = confetti.height = window.innerHeight;
      pieces = [...Array(220)].map(() => ({
        x: Math.random()*w, y: -20 - Math.random()*h, r: 5 + Math.random()*8,
        vx: -1 + Math.random()*2, vy: 2 + Math.random()*3,
        rot: Math.random()*Math.PI, vr: -0.2 + Math.random()*0.4,
      }));
    }
    function confettiTick() {
      const w = confetti.width = window.innerWidth;
      const h = confetti.height = window.innerHeight;
      ctx2d.clearRect(0,0,w,h);
      pieces.forEach(p => {
        p.x += p.vx; p.y += p.vy; p.rot += p.vr;
        if (p.y > h+20) { p.y = -20; p.x = Math.random()*w; }
        ctx2d.save(); ctx2d.translate(p.x, p.y); ctx2d.rotate(p.rot);
        ctx2d.fillStyle = Math.random() > .5 ? '#ff6f91' : '#ffd6a5';
        ctx2d.fillRect(-p.r, -p.r, p.r*2, p.r*2);
        ctx2d.restore();
      });
      requestAnimationFrame(confettiTick);
    }
    confettiTick();

    // 3D
    let THREE_OK = typeof THREE !== 'undefined';
    if (!THREE_OK) document.documentElement.classList.add('no-three');
    function getHeartGradient(g, size){
      const grad = g.createLinearGradient(0, 0, size, size);
      grad.addColorStop(0, '#ff6f91');
      grad.addColorStop(1, '#ffd6a5');
      return grad;
    }

    if (THREE_OK) {
      const canvas = document.getElementById('bg3d');
      const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
      renderer.setPixelRatio(Math.min(2, window.devicePixelRatio));
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(60, 1, 0.1, 200);
      camera.position.set(0, 0, 26);
      const amb = new THREE.AmbientLight(0xffffff, 0.7); scene.add(amb);
      const dir = new THREE.DirectionalLight(0xff6f91, 1.0); dir.position.set(5, 10, 7); scene.add(dir);
      scene.fog = new THREE.FogExp2(0x1c123a, 0.028);
      const heartTex = new THREE.CanvasTexture(makeHeartCanvas());
      const heartMat = new THREE.SpriteMaterial({ map: heartTex, transparent: true, depthWrite: false });
      const hearts = [];
      for (let i=0;i<60;i++) {
        const s = 0.8 + Math.random()*1.8;
        const spr = new THREE.Sprite(heartMat.clone());
        spr.scale.set(s, s, 1);
        spr.position.set((Math.random()-0.5)*40, (Math.random()-0.5)*22, (Math.random()-0.5)*20);
        spr.userData.v = new THREE.Vector3((Math.random()-0.5)*0.02, (Math.random()-0.5)*0.02, 0);
        scene.add(spr); hearts.push(spr);
      }
      const loader = new THREE.TextureLoader();
      const photos = [];
      PHOTO_URLS.forEach((url) => {
        loader.load(url, (tex) => {
          tex.minFilter = THREE.LinearFilter; tex.colorSpace = THREE.SRGBColorSpace;
          const geo = new THREE.PlaneGeometry(8, 6);
          const mat = new THREE.MeshStandardMaterial({ map: tex, roughness: 1, metalness: 0, transparent: true });
          const mesh = new THREE.Mesh(geo, mat);
          mesh.position.set((Math.random()-0.5)*24, (Math.random()-0.5)*14, -4 - Math.random()*10);
          mesh.rotation.z = (Math.random()-0.5)*0.6;
          mesh.userData.vy = 0.006 + Math.random()*0.014;
          scene.add(mesh); photos.push(mesh);
        }, undefined, () => {/* ignore missing images */});
      });
      const starGeo = new THREE.BufferGeometry();
      const starCount = 900;
      const positions = new Float32Array(starCount*3);
      for (let i=0;i<starCount;i++){
        positions[i*3+0] = (Math.random()-0.5)*80;
        positions[i*3+1] = (Math.random()-0.5)*44;
        positions[i*3+2] = -10 - Math.random()*30;
      }
      starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      const starMat = new THREE.PointsMaterial({ size: 0.06, color: 0xffe6c7, transparent: true, opacity: 0.85 });
      const stars = new THREE.Points(starGeo, starMat); scene.add(stars);

      function resize() {
        const w = window.innerWidth, h = window.innerHeight;
        renderer.setSize(w, h, false);
        camera.aspect = w / h; camera.updateProjectionMatrix();
      }
      window.addEventListener('resize', resize); resize();

      const clock = new THREE.Clock();
      function tick() {
        const t = clock.getElapsedTime();
        dir.position.x = Math.sin(t*0.6)*8; dir.position.y = Math.cos(t*0.4)*8;
        hearts.forEach(h => {
          h.position.add(h.userData.v);
          if (h.position.x > 22) h.position.x = -22; if (h.position.x < -22) h.position.x = 22;
          if (h.position.y > 12) h.position.y = -12; if (h.position.y < -12) h.position.y = 12;
        });
        // photos float
        for (const m of photos) {
          m.position.y += m.userData.vy || 0.01;
          if (m.position.y > 14) m.position.y = -14;
          m.rotation.z += 0.0008;
        }
        stars.rotation.z += 0.0003;
        renderer.render(scene, camera);
        requestAnimationFrame(tick);
      }
      tick();

      function makeHeartCanvas(size = 128) {
        const c = document.createElement('canvas'); c.width = c.height = size; const g = c.getContext('2d');
        g.clearRect(0,0,size,size);
        g.shadowColor = '#ff6f91'; g.shadowBlur = 16;
        g.fillStyle = getHeartGradient(g, size);
        g.beginPath();
        const x = size/2, y = size/2 + 10, r = size/6;
        g.moveTo(x, y);
        g.bezierCurveTo(x+r*2.5, y-r*2.5, x+r*2.5, y+r*0.6, x, y+r*2.4);
        g.bezierCurveTo(x-r*2.5, y+r*0.6, x-r*2.5, y-r*2.5, x, y);
        g.closePath(); g.fill();
        return c;
      }
    }

    // Initialize UI state
    updateButtons();
  </script>
</body>
</html>
